// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package templates

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "evalgo.org/graphservice/auth"

func ChangePassword(user *auth.User) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div class=\"card\" style=\"max-width: 600px; margin: 0 auto;\"><h2>Change Password</h2>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			if user.MustChangePassword {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<div class=\"alert alert-warning\" style=\"background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; margin-bottom: 1.5rem;\">‚ö† You must change your password before continuing.</div>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<form id=\"change-password-form\" onsubmit=\"changePassword(event)\"><div class=\"form-group\"><label for=\"current-password\">Current Password</label><div style=\"position: relative;\"><input type=\"password\" id=\"current-password\" name=\"current_password\" required autocomplete=\"current-password\" style=\"padding-right: 3rem;\"> <button type=\"button\" onclick=\"togglePasswordVisibility('current-password', 'current-password-toggle')\" style=\"position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-secondary); font-size: 0.875rem;\"><span id=\"current-password-toggle\">üëÅÔ∏è</span></button></div></div><div class=\"form-group\"><label for=\"new-password\">New Password</label><div style=\"position: relative;\"><input type=\"password\" id=\"new-password\" name=\"new_password\" required minlength=\"8\" autocomplete=\"new-password\" style=\"padding-right: 3rem;\"> <button type=\"button\" onclick=\"togglePasswordVisibility('new-password', 'new-password-toggle')\" style=\"position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-secondary); font-size: 0.875rem;\"><span id=\"new-password-toggle\">üëÅÔ∏è</span></button></div><small style=\"color: var(--gray-700); display: block; margin-top: 0.5rem;\">Minimum 8 characters, must include uppercase, lowercase, number, and special character</small></div><div class=\"form-group\"><label for=\"confirm-password\">Confirm New Password</label><div style=\"position: relative;\"><input type=\"password\" id=\"confirm-password\" name=\"confirm_password\" required minlength=\"8\" autocomplete=\"new-password\" style=\"padding-right: 3rem;\"> <button type=\"button\" onclick=\"togglePasswordVisibility('confirm-password', 'confirm-password-toggle')\" style=\"position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; padding: 0.25rem 0.5rem; cursor: pointer; color: var(--text-secondary); font-size: 0.875rem;\"><span id=\"confirm-password-toggle\">üëÅÔ∏è</span></button></div></div><div id=\"password-error\" style=\"margin-top: 1rem; padding: 1rem; background: #fee2e2; color: #991b1b; border-radius: 0.375rem; display: none;\"></div><div id=\"password-success\" style=\"margin-top: 1rem; padding: 1rem; background: #d1fae5; color: #065f46; border-radius: 0.375rem; display: none;\"></div><div style=\"margin-top: 1.5rem; display: flex; gap: 1rem;\"><button type=\"submit\">Change Password</button> ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			if !user.MustChangePassword {
				templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "<a href=\"/\" style=\"padding: 0.75rem 1.5rem; background: var(--gray-300); color: var(--gray-800); text-decoration: none; border-radius: 0.375rem; font-size: 1rem; font-weight: 400; text-transform: uppercase; letter-spacing: 0.5px;\">Cancel</a>")
				if templ_7745c5c3_Err != nil {
					return templ_7745c5c3_Err
				}
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "</div></form></div><style>\n\t\t\t.form-group {\n\t\t\t\tmargin-bottom: 1.25rem;\n\t\t\t}\n\t\t\t.form-group label {\n\t\t\t\tdisplay: block;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tmargin-bottom: 0.5rem;\n\t\t\t\tcolor: var(--text-primary);\n\t\t\t}\n\t\t\t.form-group input {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding: 0.75rem;\n\t\t\t\tborder: 1px solid var(--gray-300);\n\t\t\t\tborder-radius: 0.375rem;\n\t\t\t\tfont-size: 1rem;\n\t\t\t}\n\t\t\t.form-group input:focus {\n\t\t\t\toutline: none;\n\t\t\t\tborder-color: var(--primary);\n\t\t\t\tbox-shadow: 0 0 0 3px rgba(240, 90, 40, 0.1);\n\t\t\t}\n\t\t</style> <script>\n\t\t\tfunction togglePasswordVisibility(inputId, iconId) {\n\t\t\t\tconst input = document.getElementById(inputId);\n\t\t\t\tconst icon = document.getElementById(iconId);\n\n\t\t\t\tif (input.type === 'password') {\n\t\t\t\t\tinput.type = 'text';\n\t\t\t\t\ticon.textContent = 'üôà';\n\t\t\t\t} else {\n\t\t\t\t\tinput.type = 'password';\n\t\t\t\t\ticon.textContent = 'üëÅÔ∏è';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tasync function changePassword(event) {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tconst form = event.target;\n\t\t\t\tconst formData = new FormData(form);\n\n\t\t\t\tconst currentPassword = formData.get('current_password');\n\t\t\t\tconst newPassword = formData.get('new_password');\n\t\t\t\tconst confirmPassword = formData.get('confirm_password');\n\n\t\t\t\t// Clear previous messages\n\t\t\t\tdocument.getElementById('password-error').style.display = 'none';\n\t\t\t\tdocument.getElementById('password-success').style.display = 'none';\n\n\t\t\t\t// Validate passwords match\n\t\t\t\tif (newPassword !== confirmPassword) {\n\t\t\t\t\tdocument.getElementById('password-error').textContent = 'New passwords do not match';\n\t\t\t\t\tdocument.getElementById('password-error').style.display = 'block';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Validate password strength\n\t\t\t\tif (newPassword.length < 8) {\n\t\t\t\t\tdocument.getElementById('password-error').textContent = 'Password must be at least 8 characters long';\n\t\t\t\t\tdocument.getElementById('password-error').style.display = 'block';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hasUpper = /[A-Z]/.test(newPassword);\n\t\t\t\tconst hasLower = /[a-z]/.test(newPassword);\n\t\t\t\tconst hasNumber = /[0-9]/.test(newPassword);\n\t\t\t\tconst hasSpecial = /[!@#$%^&*(),.?\":{}|<>_\\-+=\\[\\]\\\\/']/.test(newPassword);\n\n\t\t\t\tif (!hasUpper || !hasLower || !hasNumber || !hasSpecial) {\n\t\t\t\t\tdocument.getElementById('password-error').textContent = 'Password must contain uppercase, lowercase, number, and special character';\n\t\t\t\t\tdocument.getElementById('password-error').style.display = 'block';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst data = {\n\t\t\t\t\tcurrent_password: currentPassword,\n\t\t\t\t\tnew_password: newPassword\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await fetch('/api/users/me/password', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify(data)\n\t\t\t\t\t});\n\n\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\tdocument.getElementById('password-success').textContent = 'Password changed successfully!';\n\t\t\t\t\t\tdocument.getElementById('password-success').style.display = 'block';\n\t\t\t\t\t\tform.reset();\n\n\t\t\t\t\t\t// Redirect to home after 2 seconds\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\twindow.location.href = '/';\n\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst error = await response.json();\n\t\t\t\t\t\tdocument.getElementById('password-error').textContent = error.error;\n\t\t\t\t\t\tdocument.getElementById('password-error').style.display = 'block';\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tdocument.getElementById('password-error').textContent = 'Failed to change password. Please try again.';\n\t\t\t\t\tdocument.getElementById('password-error').style.display = 'block';\n\t\t\t\t}\n\t\t\t}\n\t\t</script>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = Layout("Change Password", user).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
