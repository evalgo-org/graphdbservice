basePath: /
definitions:
  cmd.MigrationRequest:
    properties:
      tasks:
        description: List of tasks to execute
        items:
          $ref: '#/definitions/cmd.Task'
        type: array
      version:
        description: API version (e.g., "v0.0.1")
        type: string
    required:
    - tasks
    - version
    type: object
  cmd.Repository:
    properties:
      graph:
        description: Named graph URI or name
        type: string
      graph_new:
        description: New graph name (for graph-rename)
        type: string
      graph_old:
        description: Old graph name (for graph-rename)
        type: string
      password:
        description: GraphDB password for authentication
        type: string
      repo:
        description: Repository name
        type: string
      repo_new:
        description: New repository name (for repo-rename)
        type: string
      repo_old:
        description: Old repository name (for repo-rename)
        type: string
      url:
        description: GraphDB server URL (e.g., "http://localhost:7200")
        type: string
      username:
        description: GraphDB username for authentication
        type: string
    type: object
  cmd.Task:
    properties:
      action:
        description: The action to perform
        type: string
      src:
        allOf:
        - $ref: '#/definitions/cmd.Repository'
        description: Source repository/graph (for migration operations)
      tgt:
        allOf:
        - $ref: '#/definitions/cmd.Repository'
        description: Target repository/graph (for all operations)
    required:
    - action
    type: object
host: localhost:8080
info:
  contact:
    email: support@pantopix.com
    name: Pantopix Support
    url: https://pantopix.com
  description: |-
    GraphDB repository and graph migration service with comprehensive monitoring, logging, and user management capabilities.

    This service provides:
    - GraphDB repository migration (full backup and restore)
    - GraphDB named graph migration (individual graph transfer)
    - Repository management (create, delete, rename)
    - Graph management (import, export, delete, rename)
    - User authentication and authorization (RBAC)
    - Migration session logging and monitoring
    - Audit logging for all operations
    - Real-time task execution with SSE streaming
  license:
    name: Proprietary
    url: https://pantopix.com/license
  title: Pantopix GraphDB Service API
  version: "1.0"
paths:
  /admin/audit/api:
    get:
      description: Retrieve audit logs with optional filtering (admin only)
      parameters:
      - description: Filter by date (YYYY-MM-DD)
        in: query
        name: date
        type: string
      - description: Filter by username
        in: query
        name: username
        type: string
      - description: Filter by action
        in: query
        name: action
        type: string
      - default: 100
        description: Limit number of results
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Audit logs
          schema:
            properties:
              logs:
                items:
                  type: object
                type: array
              total:
                type: integer
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get audit logs
      tags:
      - Audit
  /admin/audit/rotate:
    post:
      description: Archive audit logs older than the retention period (admin only)
      produces:
      - application/json
      responses:
        "200":
          description: Logs rotated successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Rotate old audit logs
      tags:
      - Audit
  /admin/migrations/active:
    get:
      description: Retrieve all currently running migration sessions (admin only)
      produces:
      - application/json
      responses:
        "200":
          description: Active sessions
          schema:
            items:
              properties:
                id:
                  type: string
                start_time:
                  type: string
                status:
                  type: string
                total_tasks:
                  type: integer
                username:
                  type: string
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get active migration sessions
      tags:
      - Logs
  /admin/migrations/rotate:
    post:
      description: Archive migration logs older than the retention period (admin only)
      produces:
      - application/json
      responses:
        "200":
          description: Logs rotated successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Rotate old migration logs
      tags:
      - Logs
  /admin/migrations/session/{id}:
    get:
      description: Retrieve detailed information about a specific migration session
        (admin only)
      parameters:
      - description: Session ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Session details
          schema:
            properties:
              completed_tasks:
                type: integer
              duration_ms:
                type: integer
              failed_tasks:
                type: integer
              id:
                type: string
              metadata:
                type: object
              start_time:
                type: string
              status:
                type: string
              timeout_tasks:
                type: integer
              total_data_size_bytes:
                type: integer
              total_tasks:
                type: integer
              username:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Session not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get migration session details
      tags:
      - Logs
  /admin/migrations/stats:
    get:
      description: Retrieve migration session statistics (admin only)
      produces:
      - application/json
      responses:
        "200":
          description: Migration statistics
          schema:
            properties:
              active_sessions:
                type: integer
              completed_sessions:
                type: integer
              completed_tasks:
                type: integer
              failed_sessions:
                type: integer
              failed_tasks:
                type: integer
              timeout_tasks:
                type: integer
              total_data_size:
                type: integer
              total_tasks:
                type: integer
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get migration statistics
      tags:
      - Logs
  /admin/migrations/summary/{date}:
    get:
      description: Retrieve migration summary for a specific date (admin only)
      parameters:
      - description: Date (YYYY-MM-DD)
        in: path
        name: date
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Daily summary
          schema:
            properties:
              completed_sessions:
                type: integer
              completed_tasks:
                type: integer
              date:
                type: string
              failed_sessions:
                type: integer
              failed_tasks:
                type: integer
              sessions:
                items:
                  type: object
                type: array
              total_data_size:
                type: integer
              total_sessions:
                type: integer
              total_tasks:
                type: integer
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get daily migration summary
      tags:
      - Logs
  /admin/users:
    post:
      consumes:
      - application/json
      description: Create a new user account (admin only)
      parameters:
      - description: User data
        in: body
        name: user
        required: true
        schema:
          properties:
            email:
              type: string
            must_change_password:
              type: boolean
            password:
              type: string
            role:
              type: string
            username:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "201":
          description: User created
          schema:
            properties:
              id:
                type: string
              username:
                type: string
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: User already exists
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Create a new user
      tags:
      - Users
  /admin/users/{username}:
    delete:
      description: Delete a user account (admin only)
      parameters:
      - description: Username
        in: path
        name: username
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User deleted successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: User not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Delete user
      tags:
      - Users
    get:
      description: Get details of a specific user (admin only)
      parameters:
      - description: Username
        in: path
        name: username
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User details
          schema:
            properties:
              email:
                type: string
              failed_logins:
                type: integer
              id:
                type: string
              locked:
                type: boolean
              must_change_password:
                type: boolean
              role:
                type: string
              username:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: User not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get user details
      tags:
      - Users
    put:
      consumes:
      - application/json
      description: Update user details (admin only)
      parameters:
      - description: Username
        in: path
        name: username
        required: true
        type: string
      - description: User update data
        in: body
        name: user
        required: true
        schema:
          properties:
            email:
              type: string
            locked:
              type: boolean
            must_change_password:
              type: boolean
            password:
              type: string
            reset_failed_logins:
              type: boolean
            role:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: User updated successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: User not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Update user
      tags:
      - Users
  /admin/users/api:
    get:
      description: Returns a list of all users (admin only)
      produces:
      - application/json
      responses:
        "200":
          description: List of users
          schema:
            items:
              properties:
                email:
                  type: string
                id:
                  type: string
                locked:
                  type: boolean
                role:
                  type: string
                username:
                  type: string
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - admin only
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: List all users
      tags:
      - Users
  /api/users/me:
    get:
      description: Returns information about the currently authenticated user
      produces:
      - application/json
      responses:
        "200":
          description: User information
          schema:
            properties:
              email:
                type: string
              id:
                type: string
              role:
                type: string
              username:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get current user info
      tags:
      - Profile
  /api/users/me/password:
    post:
      consumes:
      - application/json
      description: Change the password for the currently authenticated user
      parameters:
      - description: Password change request
        in: body
        name: request
        required: true
        schema:
          properties:
            new_password:
              type: string
            old_password:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Password changed successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Change user password
      tags:
      - Profile
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user with username and password
      parameters:
      - description: Login credentials
        in: body
        name: credentials
        required: true
        schema:
          properties:
            password:
              type: string
            username:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: JWT token and user info
          schema:
            properties:
              token:
                type: string
              user:
                properties:
                  role:
                    type: string
                  username:
                    type: string
                type: object
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Invalid credentials
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User login
      tags:
      - Authentication
  /health:
    get:
      consumes:
      - application/json
      description: Returns the health status of the service
      produces:
      - application/json
      responses:
        "200":
          description: 'status: healthy'
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Health check
      tags:
      - Health
  /login:
    get:
      description: Renders the HTML login page
      produces:
      - text/html
      responses:
        "200":
          description: HTML login page
          schema:
            type: string
      summary: Login page
      tags:
      - Authentication
  /logout:
    get:
      description: Clear authentication session and redirect to login
      responses:
        "302":
          description: Redirect to login page
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: User logout
      tags:
      - Authentication
  /ui/execute:
    post:
      consumes:
      - application/json
      description: Execute GraphDB tasks through the web interface with real-time
        updates
      parameters:
      - description: Task execution request
        in: body
        name: request
        required: true
        schema:
          properties:
            tasks:
              items:
                type: object
              type: array
            version:
              type: string
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Session ID for streaming results
          schema:
            properties:
              session_id:
                type: string
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Execute tasks via Web UI
      tags:
      - Migration
  /ui/stream/{sessionID}:
    get:
      description: Server-Sent Events stream for real-time task execution updates
      parameters:
      - description: Session ID
        in: path
        name: sessionID
        required: true
        type: string
      produces:
      - text/event-stream
      responses:
        "200":
          description: SSE stream
          schema:
            type: string
      security:
      - BearerAuth: []
      summary: Stream task execution results
      tags:
      - Migration
  /v1/api/action:
    post:
      consumes:
      - application/json
      description: |-
        Execute one or more GraphDB migration tasks (repository migration, graph migration, etc.)

        Supported actions:
        - repo-migration: Full repository migration (backup and restore)
        - graph-migration: Named graph migration
        - repo-create: Create a new repository
        - repo-delete: Delete a repository
        - repo-rename: Rename a repository
        - graph-import: Import RDF data into a graph
        - graph-export: Export RDF data from a graph
        - graph-delete: Delete a named graph
        - graph-rename: Rename a named graph
      parameters:
      - description: Migration request with tasks
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/cmd.MigrationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Migration results
          schema:
            properties:
              results:
                items:
                  type: object
                type: array
              version:
                type: string
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - ApiKeyAuth: []
      summary: Execute GraphDB migration tasks
      tags:
      - Migration
securityDefinitions:
  ApiKeyAuth:
    description: API Key for external integrations
    in: header
    name: X-API-Key
    type: apiKey
  BearerAuth:
    description: 'JWT token for authenticated users (format: "Bearer {token}")'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
